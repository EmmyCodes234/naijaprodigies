# Authentication Flow Diagram

## User Journey

```
┌─────────────────────────────────────────────────────────────────┐
│                         User Visits App                          │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    AuthProvider Initializes                      │
│  • Checks for existing session in browser storage                │
│  • Sets up auth state listener                                   │
│  • Updates user/session state                                    │
└─────────────────────────────────────────────────────────────────┘
                              │
                    ┌─────────┴─────────┐
                    │                   │
                    ▼                   ▼
        ┌──────────────────┐  ┌──────────────────┐
        │  No Session      │  │  Session Found   │
        │  (Not Logged In) │  │  (Logged In)     │
        └──────────────────┘  └──────────────────┘
                    │                   │
                    │                   ▼
                    │         ┌──────────────────┐
                    │         │ Fetch User       │
                    │         │ Profile from DB  │
                    │         └──────────────────┘
                    │                   │
                    ▼                   ▼
        ┌──────────────────────────────────────┐
        │      User Clicks "Sign In"           │
        └──────────────────────────────────────┘
                    │
                    ▼
        ┌──────────────────────────────────────┐
        │       AuthModal Opens                │
        └──────────────────────────────────────┘
                    │
        ┌───────────┴───────────┐
        │                       │
        ▼                       ▼
┌──────────────┐      ┌──────────────┐
│   Sign In    │      │   Sign Up    │
└──────────────┘      └──────────────┘
        │                       │
        │                       ▼
        │           ┌──────────────────────┐
        │           │ Enter:               │
        │           │ • Email              │
        │           │ • Password           │
        │           │ • Handle             │
        │           │ • Name               │
        │           └──────────────────────┘
        │                       │
        │                       ▼
        │           ┌──────────────────────┐
        │           │ Supabase Auth        │
        │           │ Creates User         │
        │           └──────────────────────┘
        │                       │
        │                       ▼
        │           ┌──────────────────────┐
        │           │ Database Trigger     │
        │           │ Creates Profile      │
        │           │ in users table       │
        │           └──────────────────────┘
        │                       │
        └───────────┬───────────┘
                    │
                    ▼
        ┌──────────────────────────────────────┐
        │    User Successfully Authenticated    │
        │    • Session stored in browser        │
        │    • Auth state updated               │
        │    • Modal closes                     │
        └──────────────────────────────────────┘
                    │
                    ▼
        ┌──────────────────────────────────────┐
        │   User Can Access Protected Routes   │
        │   • Social Feed                       │
        │   • Create Posts                      │
        │   • Like/Comment                      │
        └──────────────────────────────────────┘
```

## Protected Route Flow

```
User navigates to /feed
        │
        ▼
┌──────────────────┐
│ ProtectedRoute   │
│ Component        │
└──────────────────┘
        │
        ▼
┌──────────────────┐
│ Check Auth State │
└──────────────────┘
        │
    ┌───┴───┐
    │       │
    ▼       ▼
┌─────┐ ┌─────────┐
│ No  │ │  Yes    │
│Auth │ │  Auth   │
└─────┘ └─────────┘
    │         │
    ▼         ▼
┌─────────┐ ┌──────────────┐
│Redirect │ │ Render       │
│to Home  │ │ Social Feed  │
└─────────┘ └──────────────┘
```

## Database Security Flow

```
User attempts to create a post
        │
        ▼
┌──────────────────────────────────┐
│ Frontend calls postService       │
│ with post data                   │
└──────────────────────────────────┘
        │
        ▼
┌──────────────────────────────────┐
│ Supabase Client sends request    │
│ with auth token                  │
└──────────────────────────────────┘
        │
        ▼
┌──────────────────────────────────┐
│ Supabase validates auth token    │
└──────────────────────────────────┘
        │
        ▼
┌──────────────────────────────────┐
│ RLS Policy checks:               │
│ • Is user authenticated?         │
│ • Does user_id match auth_id?    │
└──────────────────────────────────┘
        │
    ┌───┴───┐
    │       │
    ▼       ▼
┌─────┐ ┌─────────┐
│Fail │ │ Pass    │
└─────┘ └─────────┘
    │         │
    ▼         ▼
┌─────────┐ ┌──────────────┐
│ Return  │ │ Insert post  │
│ Error   │ │ into DB      │
└─────────┘ └──────────────┘
                  │
                  ▼
            ┌──────────────┐
            │ Return       │
            │ Success      │
            └──────────────┘
```

## Sign Out Flow

```
User clicks "Sign Out"
        │
        ▼
┌──────────────────────────────────┐
│ AuthContext.signOut() called     │
└──────────────────────────────────┘
        │
        ▼
┌──────────────────────────────────┐
│ Supabase clears session          │
└──────────────────────────────────┘
        │
        ▼
┌──────────────────────────────────┐
│ Auth state listener triggers     │
└──────────────────────────────────┘
        │
        ▼
┌──────────────────────────────────┐
│ user and session set to null     │
└──────────────────────────────────┘
        │
        ▼
┌──────────────────────────────────┐
│ UI updates to show "Sign In"     │
└──────────────────────────────────┘
        │
        ▼
┌──────────────────────────────────┐
│ Protected routes become           │
│ inaccessible                      │
└──────────────────────────────────┘
```

## Key Components Interaction

```
┌─────────────────────────────────────────────────────────────┐
│                         App.tsx                              │
│  ┌────────────────────────────────────────────────────────┐ │
│  │                   AuthProvider                          │ │
│  │  • Manages global auth state                           │ │
│  │  • Provides auth methods                               │ │
│  │  ┌──────────────────────────────────────────────────┐  │ │
│  │  │              Navbar                               │  │ │
│  │  │  • Shows Sign In/Out button                       │  │ │
│  │  │  • Uses useAuth() hook                            │  │ │
│  │  └──────────────────────────────────────────────────┘  │ │
│  │  ┌──────────────────────────────────────────────────┐  │ │
│  │  │              Routes                               │  │ │
│  │  │  ┌────────────────────────────────────────────┐  │  │ │
│  │  │  │  ProtectedRoute                            │  │  │ │
│  │  │  │  • Checks auth state                       │  │  │ │
│  │  │  │  • Redirects if not authenticated          │  │  │ │
│  │  │  │  ┌──────────────────────────────────────┐  │  │  │ │
│  │  │  │  │     SocialFeed                       │  │  │  │ │
│  │  │  │  │  • Uses useCurrentUser() hook        │  │  │  │ │
│  │  │  │  │  • Displays user-specific content    │  │  │  │ │
│  │  │  │  └──────────────────────────────────────┘  │  │  │ │
│  │  │  └────────────────────────────────────────────┘  │  │ │
│  │  └──────────────────────────────────────────────────┘  │ │
│  │  ┌──────────────────────────────────────────────────┐  │ │
│  │  │              AuthModal                            │  │ │
│  │  │  • Sign in/up form                                │  │ │
│  │  │  • Calls signIn()/signUp()                        │  │ │
│  │  └──────────────────────────────────────────────────┘  │ │
│  └────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
                ┌──────────────────────┐
                │  Supabase Backend    │
                │  • Auth Service      │
                │  • Database + RLS    │
                │  • Storage           │
                └──────────────────────┘
```
